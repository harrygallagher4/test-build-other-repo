name: Build parinfer-rust

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@master
        with:
          repository: eraserhd/parinfer-rust
      - uses: actions-rs/toolchain@master
        with:
          toolchain: stable
#      - name: Install targets
#        run: |
#          sudo apt-get install -y mingw-w64
#          rustup target add x86_64-pc-windows-gnu
#          rustup target add x86_64-unknown-linux-gnu
      - uses: Shogan/rust-musl-action@master
        with:
          args: cargo build --target x86_64-apple-darwin --release
      - uses: Shogan/rust-musl-action@master
        with:
          args: cargo build --target x86_64-unknown-linux-musl --release
      - uses: Shogan/rust-musl-action@master
        with:
          args: cargo build --target aarch64-unknown-linux-musl --release
      - uses: Shogan/rust-musl-action@master
        with:
          args: cargo build --target x86_64-pc-windows-gnu --release
      - run: ls --recursive target

#      - uses: actions/upload-artifact@v3.1.0
#        with:
#          path: |
#            target/release/libparinfer_rust.dylib
#            target/release/libparinfer_rust.so
#            target/release/parinfer_rust.dll

